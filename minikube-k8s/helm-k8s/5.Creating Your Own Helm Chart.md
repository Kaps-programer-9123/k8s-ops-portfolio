## **Step 5: Creating Your Own Helm Chart ðŸ› **

So far, weâ€™ve been using **pre-built charts (e.g., Bitnami)**. Now, letâ€™s create one from scratch to learn its structure and templating.

---

### **5.1 Scaffold a New Chart ðŸ“¦**

Run:

```bash
helm create mychart
```

This generates:

```
mychart/
â”œâ”€â”€ Chart.yaml        # Chart metadata (name, version, description)
â”œâ”€â”€ values.yaml       # Default values for your chart
â”œâ”€â”€ charts/           # For chart dependencies (optional)
â”œâ”€â”€ templates/        # K8s manifest templates
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â”œâ”€â”€ _helpers.tpl  # Reusable template helpers
â”‚   â””â”€â”€ tests/test-connection.yaml
â””â”€â”€ .helmignore       # Files to ignore when packaging
```

---

### **5.2 Understanding Key Files ðŸ§ **

* **Chart.yaml** â†’ Name, version, description of the chart.
* **values.yaml** â†’ Default configuration (you can override later).
* **templates/** â†’ Contains Go templated Kubernetes YAML files.
* **\_helpers.tpl** â†’ Stores helper templates for reusability.

---

### **5.3 Customize Your Chart ðŸŽ¨**

Example: Change default image & replica count.

Edit `values.yaml`:

```yaml
replicaCount: 2

image:
  repository: nginx
  tag: "latest"
  pullPolicy: IfNotPresent

service:
  type: NodePort
  port: 80
```

---

### **5.4 Deploy Your Custom Chart ðŸš€**

Install it on Minikube:

```bash
helm install my-nginx-local ./mychart
```

Verify:

```bash
kubectl get pods
kubectl get svc
```

---

### **5.5 Upgrade Your Chart ðŸ”„**

Change `replicaCount` in `values.yaml` from 2 â†’ 3:

```bash
helm upgrade my-nginx-local ./mychart
```

Check:

```bash
kubectl get pods
```

---

### **5.6 Package & Share Your Chart ðŸ“¤**

Once ready:

```bash
helm package mychart
```

This creates a `.tgz` file â†’ your distributable Helm chart.

You can:

* Push it to a **Helm repository** (e.g., ChartMuseum, Harbor)
* Share it internally in your team
* Version it (e.g., `1.0.0`, `1.1.0`)

---

### **5.7 Test Your Chart ðŸ§ª**

Helm provides testing:

```bash
helm test my-nginx-local
```

Default chart includes a simple `test-connection.yaml`.

---

Here's a detailed **text-based diagram** illustrating the **Helm Chart Structure** and **Lifecycle**:

### **Helm Chart Structure**

```
my-helm-chart/
â”œâ”€â”€ Chart.yaml            # Contains metadata like name, version, description
â”œâ”€â”€ values.yaml           # Default configuration values (e.g., image tag, replicas)
â”œâ”€â”€ templates/            # Kubernetes manifests (e.g., deployment, service, ingress)
â”‚   â”œâ”€â”€ deployment.yaml   # Defines the Deployment resource
â”‚   â”œâ”€â”€ service.yaml      # Defines the Service resource
â”‚   â””â”€â”€ ingress.yaml      # Defines the Ingress resource
â”œâ”€â”€ charts/               # Subcharts (if the chart depends on other charts)
â”‚   â””â”€â”€ some-subchart/    # Example of a subchart for another component like a DB
â””â”€â”€ README.md             # Documentation for the chart (optional)
```

### **Helm Chart Lifecycle**

```
1. Helm Linting
   â”œâ”€â”€ Purpose: Validates the chart for errors and warnings.
   â””â”€â”€ Command: helm lint ./my-chart
   â””â”€â”€ Output: Linting errors (if any), which should be fixed before proceeding.

2. Helm Package
   â”œâ”€â”€ Purpose: Packages the chart into a .tgz file for distribution.
   â””â”€â”€ Command: helm package ./my-chart
   â””â”€â”€ Output: my-chart-<version>.tgz (a packaged chart ready for installation)

3. Helm Install
   â”œâ”€â”€ Purpose: Installs the chart into a Kubernetes cluster.
   â””â”€â”€ Command: helm install <release-name> ./my-chart
   â””â”€â”€ Output: Kubernetes resources are created, and the chart is deployed.

4. Helm Upgrade
   â”œâ”€â”€ Purpose: Upgrades an existing release (i.e., deployment update).
   â””â”€â”€ Command: helm upgrade <release-name> ./my-chart
   â””â”€â”€ Output: The chart gets upgraded with new configurations (like a new image version).

5. Helm Rollback
   â”œâ”€â”€ Purpose: Reverts to a previous release version if there was an issue with the upgrade.
   â””â”€â”€ Command: helm rollback <release-name> <revision>
   â””â”€â”€ Output: The deployment reverts to a previous working state.

6. Helm Uninstall
   â”œâ”€â”€ Purpose: Removes the Helm release and associated resources from Kubernetes.
   â””â”€â”€ Command: helm uninstall <release-name>
   â””â”€â”€ Output: The resources created by Helm are deleted from the cluster.

```

---

### **Flow of the Helm Chart Lifecycle**

1. **Linting** â†’ Check for errors in chart structure.
2. **Packaging** â†’ Prepare the chart for installation or sharing.
3. **Install** â†’ Deploy the chart to Kubernetes.
4. **Upgrade** â†’ Update the chart version (e.g., new application version).
5. **Rollback** â†’ Revert the deployment to a previous working version.
6. **Uninstall** â†’ Remove all Kubernetes resources and the Helm release.

---

This layout reflects the structure of a Helm chart (files and directories) as well as the common lifecycle commands and their purposes. Each step in the lifecycle is iterative, and you may revisit these steps multiple times during the development and deployment process.


### **What You Learned in Step 5 âœ…**

* How to **create a chart from scratch**
* Understand its structure & templating basics
* Deploy, upgrade, and package your own Helm chart

---

### **Next Step â†’ Step 6: Advanced Helm Concepts âš¡**

* Chart dependencies (subcharts)
* Hooks (pre/post-install actions)
* Secrets & ConfigMaps
* Linting & validating (`helm lint`, `helm template`)

---

