## **Step 6: Advanced Helm Concepts âš¡**

In this step, weâ€™ll go beyond basics: managing complex apps, automating lifecycle events, and ensuring reliability in production.

---

### **6.1 Chart Dependencies (Subcharts) ğŸ§©**

* Helm allows **charts within charts** (called *subcharts*).
* Useful when your app depends on other services (e.g., WordPress â†’ needs MySQL).

#### **How to add dependencies:**

1. Edit `Chart.yaml`:

```yaml
dependencies:
  - name: mysql
    version: 9.x.x
    repository: "https://charts.bitnami.com/bitnami"
```

2. Update dependencies:

```bash
helm dependency update
```

3. Install chart â†’ it will install subchart automatically.

---

### **6.2 Helm Hooks (Lifecycle Events) â±**

* Hooks are like **triggers** before/after Helm actions.
* Example: Run a DB migration **before upgrade**.

Common hooks:

* `pre-install`
* `post-install`
* `pre-upgrade`
* `post-upgrade`
* `pre-delete`
* `post-delete`

#### **Example: Job as a Hook**

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: db-migration
  annotations:
    "helm.sh/hook": pre-upgrade
spec:
  template:
    spec:
      containers:
        - name: migrate
          image: my-dbmigrate:latest
      restartPolicy: OnFailure
```

---

### **6.3 Secrets & ConfigMaps with Helm ğŸ”**

* Use `values.yaml` to inject environment variables or secrets.
* For sensitive data:

```yaml
env:
  - name: DATABASE_PASSWORD
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: password
```

Helm can also manage secrets using tools like **Sealed Secrets** or **External Secrets Operator**.

---

### **6.4 Helm Testing ğŸ§ª**

* Add test manifests in `templates/tests/`
* Run:

```bash
helm test <release-name>
```

Ensures app health after deployment or upgrade.

---

### **6.5 Linting & Validation ğŸ•µï¸â€â™‚ï¸**

* Catch issues before deployment:

```bash
helm lint ./mychart
```

* Render templates without installing:

```bash
helm template ./mychart
```

This shows final Kubernetes YAML that Helm will apply.

---

### **6.6 Helm in Production & CI/CD ğŸ­**

* Store charts in a private repo (e.g., **ChartMuseum, Harbor**).
* Automate with CI/CD:

  * **Build chart** â†’ `helm lint`
  * **Package chart** â†’ `helm package`
  * **Push to repo**
  * **Deploy via pipeline** â†’ `helm upgrade --install`
* GitOps tools like **ArgoCD** or **FluxCD** can automatically deploy Helm charts from Git.

---

### **6.7 Rollbacks & History âª**

* Check history:

```bash
helm history <release-name>
```

* Rollback:

```bash
helm rollback <release-name> <revision-number>
```

Revision numbers increase with each upgrade.

---

### **What You Learned in Step 6 âœ…**

* Manage **chart dependencies (subcharts)**
* Use **hooks** for lifecycle tasks
* Handle **secrets & ConfigMaps**
* Perform **linting, testing, and validation**
* Integrate Helm into **production CI/CD pipelines**

---

### **Next Step â†’ Step 7: Helm in Real Projects (CI/CD & Production) ğŸ”„**

* Versioning and repositories
* Automated rollbacks
* GitOps workflows
* Best practices for production

___

[Back to Step 5 â€” Creating Your Own Helm Chart](https://github.com/Kaps-programer-9123/k8s-ops-portfolio/blob/main/minikube-k8s/helm-k8s/5.Creating%20Your%20Own%20Helm%20Chart.md)

[Read Step 7 â€” Helm in Real Projects](https://github.com/Kaps-programer-9123/k8s-ops-portfolio/blob/main/minikube-k8s/helm-k8s/7.Helm%20in%20Real%20Projects.md)