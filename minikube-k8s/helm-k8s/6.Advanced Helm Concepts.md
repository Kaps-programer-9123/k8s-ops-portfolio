## **Step 6: Advanced Helm Concepts ⚡**

In this step, we’ll go beyond basics: managing complex apps, automating lifecycle events, and ensuring reliability in production.

---

### **6.1 Chart Dependencies (Subcharts) 🧩**

* Helm allows **charts within charts** (called *subcharts*).
* Useful when your app depends on other services (e.g., WordPress → needs MySQL).

#### **How to add dependencies:**

1. Edit `Chart.yaml`:

```yaml
dependencies:
  - name: mysql
    version: 9.x.x
    repository: "https://charts.bitnami.com/bitnami"
```

2. Update dependencies:

```bash
helm dependency update
```

3. Install chart → it will install subchart automatically.

---

### **6.2 Helm Hooks (Lifecycle Events) ⏱**

* Hooks are like **triggers** before/after Helm actions.
* Example: Run a DB migration **before upgrade**.

Common hooks:

* `pre-install`
* `post-install`
* `pre-upgrade`
* `post-upgrade`
* `pre-delete`
* `post-delete`

#### **Example: Job as a Hook**

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: db-migration
  annotations:
    "helm.sh/hook": pre-upgrade
spec:
  template:
    spec:
      containers:
        - name: migrate
          image: my-dbmigrate:latest
      restartPolicy: OnFailure
```

---

### **6.3 Secrets & ConfigMaps with Helm 🔐**

* Use `values.yaml` to inject environment variables or secrets.
* For sensitive data:

```yaml
env:
  - name: DATABASE_PASSWORD
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: password
```

Helm can also manage secrets using tools like **Sealed Secrets** or **External Secrets Operator**.

---

### **6.4 Helm Testing 🧪**

* Add test manifests in `templates/tests/`
* Run:

```bash
helm test <release-name>
```

Ensures app health after deployment or upgrade.

---

### **6.5 Linting & Validation 🕵️‍♂️**

* Catch issues before deployment:

```bash
helm lint ./mychart
```

* Render templates without installing:

```bash
helm template ./mychart
```

This shows final Kubernetes YAML that Helm will apply.

---

### **6.6 Helm in Production & CI/CD 🏭**

* Store charts in a private repo (e.g., **ChartMuseum, Harbor**).
* Automate with CI/CD:

  * **Build chart** → `helm lint`
  * **Package chart** → `helm package`
  * **Push to repo**
  * **Deploy via pipeline** → `helm upgrade --install`
* GitOps tools like **ArgoCD** or **FluxCD** can automatically deploy Helm charts from Git.

---

### **6.7 Rollbacks & History ⏪**

* Check history:

```bash
helm history <release-name>
```

* Rollback:

```bash
helm rollback <release-name> <revision-number>
```

Revision numbers increase with each upgrade.

---

### **What You Learned in Step 6 ✅**

* Manage **chart dependencies (subcharts)**
* Use **hooks** for lifecycle tasks
* Handle **secrets & ConfigMaps**
* Perform **linting, testing, and validation**
* Integrate Helm into **production CI/CD pipelines**

---

### **Next Step → Step 7: Helm in Real Projects (CI/CD & Production) 🔄**

* Versioning and repositories
* Automated rollbacks
* GitOps workflows
* Best practices for production

---